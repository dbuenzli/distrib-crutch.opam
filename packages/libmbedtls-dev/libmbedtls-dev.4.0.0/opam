opam-version: "2.0"
synopsis: "The mbedtls C library"
description:"This package installs the mbedtls C library."
maintainer: "opam-distrib-crutch maintainers"
x-distrib-status: "https://repology.org/project/mbedtls"
homepage: "https://repology.org/project/mbedtls"
dev-repo: "git+https://github.com/Mbed-TLS/mbedtls"
bug-reports: "https://github.com/Mbed-TLS/mbedtls/issues"
authors: ["The mbedtls programmers"]
license: "Apache-2.0 OR GPL-2.0-or-later"
depends: [
"conf-c-env"
"conf-pkg-config" {build}
"conf-cmake" {build}
]
build:
[
  [ "./tf-psa-crypto/scripts/config.py"
      "--file" "./tf-psa-crypto/include/psa/crypto_config.h" "set"
      "MBEDTLS_THREADING_C" ]

  [ "./tf-psa-crypto/scripts/config.py"
      "--file" "./tf-psa-crypto/include/psa/crypto_config.h" "set"
      "MBEDTLS_THREADING_PTHREAD" ]

  ["cmake" "."
      "-DUSE_SHARED_MBEDTLS_LIBRARY=On"
      "-DENABLE_PROGRAMS=Off"
      "-DENABLE_TESTING=Off"
      "-DCMAKE_INSTALL_RPATH=%{lib}%"
      "-DCMAKE_INSTALL_NAME_DIR=%{lib}%" # To have the correct @rpath
      "-DGEN_FILES=OFF"
      "-DCMAKE_INSTALL_PREFIX=%{prefix}%"
      "-DCMAKE_INSTALL_LIBDIR=%{lib}%"
      "-DCMAKE_VERBOSE_MAKEFILE=ON" ]
  ["cmake" "--build" "."]
]
install:
[
  ["cmake" "--install" "."]
]
url {
src: "https://github.com/Mbed-TLS/mbedtls/releases/download/mbedtls-4.0.0/mbedtls-4.0.0.tar.bz2"
checksum:
"sha256=2f3a47f7b3a541ddef450e4867eeecb7ce2ef7776093f3a11d6d43ead6bf2827"
}
